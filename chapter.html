<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capitolul | Club de LecturƒÉ Trading</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
        <!-- Chart Bars Left -->
    <div class="chart-bars chart-bars-left">
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
    </div>

    <!-- Chart Bars Right -->
    <div class="chart-bars chart-bars-right">
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
        <div class="chart-bar-group">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
        </div>
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <span>üìö</span>
                <span>BookClub</span>
            </a>
            
            <button class="nav-toggle" id="navToggle">‚ò∞</button>
            
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html" class="nav-link">üìä Panou</a></li>
                <li><a href="library.html" class="nav-link">üìö BibliotecƒÉ</a></li>
                <li><a href="notes.html" class="nav-link">üìù Noti»õe</a></li>
                <li><a href="leaderboard.html" class="nav-link">üèÜ Clasament</a></li>
                <li><a href="insigne.html" class="nav-link">üèÖ Insigne</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div id="chapter-content">
            <!-- Populated by JS -->
        </div>
    </main>

    <footer class="footer">
        <p>¬© 2026 Trading Book Club. √émbunƒÉtƒÉ»õe»ôte-»õi cuno»ôtin»õele de trading.</p>
    </footer>

    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const chapterId = parseInt(urlParams.get('id')) || 1;
            
            loadCapitolul(chapterId);
        });

        function loadCapitolul(chapterId) {
            const chapter = BookClub.getCapitolulById(chapterId);
            const container = document.getElementById('chapter-content');
            
            if (!chapter) {
                container.innerHTML = '<div class="empty-state"><h2>Capitolul not found</h2></div>';
                return;
            }
            
            const book = BookClub.getBookById(chapter.book_id);
            const user = BookClub.getCurrentUser();
            const isCompletate = user && BookClub.isCapitolulCompletate(user.id, chapter.id);
            const quiz = BookClub.getQuizByCapitolul(chapter.id);
            const quizResult = user ? BookClub.getQuizResult(user.id, chapter.id) : null;
            
            const allCapitole = BookClub.getCapitoleByBook(chapter.book_id);
            const currentIndex = allCapitole.findIndex(c => c.id === chapterId);
            const prevCapitolul = currentIndex > 0 ? allCapitole[currentIndex - 1] : null;
            const nextCapitolul = currentIndex < allCapitole.length - 1 ? allCapitole[currentIndex + 1] : null;
            
            const notes = BookClub.getNoti»õeForCapitolul(chapterId);
            
            container.innerHTML = `
                <div class="breadcrumb">
                    <a href="library.html">BibliotecƒÉ</a>
                    <span class="breadcrumb-separator">/</span>
                    <a href="book.html?id=${book.id}">${book.title}</a>
                    <span class="breadcrumb-separator">/</span>
                    <span>Capitolul ${chapter.number}</span>
                </div>

                <div class="chapter-navigation">
                    ${prevCapitolul ? `
                        <a href="chapter.html?id=${prevCapitolul.id}" class="btn btn-sm btn-secondary">‚Üê Anterior</a>
                    ` : '<span class="btn btn-sm btn-disabled">‚Üê Anterior</span>'}
                    
                    <span class="chapter-indicator">Capitolul ${chapter.number} din ${allCapitole.length}</span>
                    
                    ${nextCapitolul ? `
                        <a href="chapter.html?id=${nextCapitolul.id}" class="btn btn-sm btn-secondary">UrmƒÉtor ‚Üí</a>
                    ` : '<span class="btn btn-sm btn-disabled">UrmƒÉtor ‚Üí</span>'}
                </div>

                <div class="chapter-header">
                    <h1>${chapter.title}</h1>
                    
                    ${isCompletate ? `
                        <div class="completion-badge">
                            ‚úì Completate
                        </div>
                    ` : ''}
                </div>

                <div class="chapter-content-grid">
                    <!-- Main Content -->
                    <div class="card chapter-content-card">
                        <div class="card-header">
                            <h2>üìù Rezumat</h2>
                        </div>
                        <div class="card-body">
                            <div class="chapter-summary">
                                ${chapter.summary || '<p class="empty-state">Niciun rezumat disponibil.</p>'}
                            </div>
                            
                            ${chapter.key_concepts ? `
                                <div class="key-concepts-section">
                                    <h4>Concepte Cheie</h4>
                                    <div class="key-concepts">
                                        ${chapter.key_concepts.map(concept => `
                                            <span class="concept-tag">${concept}</span>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="chapter-sidebar">
                        <!-- Quiz Card -->
                        ${quiz ? `
                            <div class="card">
                                <div class="card-header">
                                    <h3>‚ùì Quiz</h3>
                                </div>
                                <div class="card-body">
                                    ${quizResult ? `
                                        <div class="quiz-status">
                                            <div class="quiz-score ${quizResult.score >= 8 ? 'excellent' : quizResult.score >= 6 ? 'good' : 'needs-work'}">
                                                <span class="score-value">${quizResult.score}</span>
                                                <span class="score-total">/${quizResult.maxScore}</span>
                                            </div>
                                            <p>${quizResult.score >= 8 ? 'Excellent!' : quizResult.score >= 6 ? 'Good job!' : 'ContinuƒÉ sƒÉ √Ænve»õi!'}</p>
                                            <a href="quiz.html?chapter=${chapter.id}" class="btn btn-secondary btn-block">Reia Quiz</a>
                                        </div>
                                    ` : `
                                        <p>TesteazƒÉ-»õi cuno»ôtin»õele with ${quiz.questions.length} questions.</p>
                                        <a href="quiz.html?chapter=${chapter.id}" class="btn btn-primary btn-block">üéØ √éncepe Quiz</a>
                                    `}
                                </div>
                            </div>
                        ` : ''}

                        <!-- Mark Complet Card -->
                        ${user && !isCompletate ? `
                            <div class="card">
                                <div class="card-header">
                                    <h3>‚úì Progres</h3>
                                </div>
                                <div class="card-body">
                                    <button class="btn btn-success btn-block" onclick="handleComplet(${chapter.id})">
                                        Mark as Complet
                                    </button>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <!-- Noti»õe Section -->
                <div class="card">
                    <div class="card-header">
                        <h2>üí¨ Shared Noti»õe</h2>
                    </div>
                    <div class="card-body">
                        ${user ? `
                            <div class="add-note-form">
                                <textarea id="note-input" placeholder="√émpƒÉrtƒÉ»ôe»ôte ideile tale, key takeaways, or questions about this chapter..." rows="3"></textarea>
                                <button class="btn btn-primary" onclick="handleAddNote(${chapter.id})">
                                    üìù PartajeazƒÉ Noti»õa
                                </button>
                            </div>
                        ` : '<p class="empty-state"><a href="index.html">SelecteazƒÉ un utilizator</a> to add notes.</p>'}
                        
                        <div id="notes-list" class="notes-list">
                            ${notes.length > 0 ? notes.map(note => `
                                <div class="note-item">
                                    <div class="note-header">
                                        <span class="note-author">üë§ ${note.user_name}</span>
                                        <span class="note-time">${BookClub.formatRelativeTime(note.created_at)}</span>
                                    </div>
                                    <div class="note-content">${note.note}</div>
                                </div>
                            `).join('') : '<p class="empty-state" id="no-notes-msg">Nicio noti»õƒÉ √ÆncƒÉ. Fii primul to share your thoughts!</p>'}
                        </div>
                    </div>
                </div>
            `;
        }

        function handleComplet(chapterId) {
            BookClub.markCapitolulComplet(chapterId);
            setTimeout(() => location.reload(), 1000);
        }

        function handleAddNote(chapterId) {
            const noteInput = document.getElementById('note-input');
            const noteText = noteInput.value.trim();
            
            if (!noteText) {
                BookClub.showNotification('Please enter a note!', 'warning');
                return;
            }
            
            if (BookClub.addNote(chapterId, noteText)) {
                setTimeout(() => location.reload(), 1000);
            }
        }
    </script>
</body>
</html>
